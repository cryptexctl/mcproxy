# mcproxy

Прокси-ретранслятор для Minecraft-серверов, решающий две задачи:

1. обход геоблокировок (внешний VPS принимает соединение, трафик шлётся к Velocity в РФ);
2. сохранение реальных IP-адресов игроков на backend без iptables.

Поддерживаются:
* TCP потоки (игровой протокол);
* UDP пакеты (PlasmoVoice);
* PROXY-protocol v1 (первый строковый пакет).

## Архитектура
```
Client ───► mcproxy (VPS) ───► Velocity ───► Purpur
    ^                             ^
    │ TCP+UDP                     │ ip_forward (modern)
    │ PROXY v1                    │
    v                             v
  PlasmoVoice               LimboAuth / плагины
```

* mcproxy добавляет строку `PROXY TCP4 <real> <proxy> <port> 25565\r\n` перед передачей данных.
* Velocity читает заголовок при `haproxy-protocol = true` и пересылает IP дальше.
* Purpur с `bungeecord: true` (spigot.yml) получает адрес в логин-пакете.

## Сборка
```sh
$ go build -o mcproxy
```

Требуется Go ≥1.21. Модуль зависимостей — `go.mod`.

## Конфигурация
Файл `config.toml`:
```toml
[listen]
 tcp = ":25565"
 udp = ":25565"

[backend]
 tcp = "127.0.0.1:25565"
 udp = "127.0.0.1:25565"

idle_timeout_seconds = 300
```

## Запуск
```
$ ./mcproxy             # в каталоге с config.toml
```

## Безопасность
mcproxy не выполняет аутентификацию. Предполагается, что UDP/TCP трафик ограничен фаерволом между VPS и backend.

## Откуда появилась идея?

В свое время я сисадминил майнкрафт сервер, и появилась одна проблема, когда мой друг пытался зайти на сервер, но не мог, так как сервер был заблокирован в России. Долгое время я костылил подключение через 25565 на другом сервере, но это было неудобно + отваливался войсчат прям в 0, что ващето оч неудобно, поэтому я решил: 
> нужно сделать прокси-ретранслятор для майнкрафт серверов, который будет решать эту проблему.
Вот собственно и сам проект.